# 电子时钟

## 要求

1. 用 LCD1602 显示

2. 能够显示年、月、日、时、分、秒

3. 可以通过按键调整时间。
4. 用 T1 定时器。

## 实现思路

> 演示版本（只完成了时分秒）：https://www.bilibili.com/video/BV1qA411t7g1

1. 计时

   定时器方式 2，200μs（0.2ms）中断一次，每次计数，中断 5000 次后时间就过了 1 秒，修改对应位的数值即可

2. 显示

   通过 LCD1602 显示

   第一行年月日 `0000/00/00`

   第二行时分秒 `00/00/00`

   用符号 `/` 间隔

   > 其实可以再加个毫秒

3. 时间进位

   > 实现一个结构体 `Date` 可能比较合适

   年 `year`：不需要考虑进位的问题

   月 `month`：当 `month==12` 时，`year++`，`month=0`

   日 `day`：当 `month` 和 `day` 满足特定条件时（需要考虑润月），`month++`，`day=0` 

   时 `hour`：当`hour==24` 时，`day++` ，`hour=0`

   分 `minute`：当 `minute==60` 时，`hour++`，`minute=0`

   秒 `second`：当 `second==60` 时，`minute++`，`second=0`

4. 按键调整

   用矩阵按键，赋予按键含义（共 16 个按键）

   数值输入：`0~9` （按键足够，只改数值，不用向后移动光标）

   光标移动：`←`、`→`、`↑`、`↓`（上下换行直接到行首比较合适，应该是有光标功能，没试过）

   Modify/Confirm：第一次按下修改，光标到 第 0 行第 0 列；再次按下确认，LCD1602 恢复显示

   On/Off：开关屏幕（不知道能不能实现，不行的话就清屏）

   > 位数是写死的，根据光标的位置和按下的数字修改显示的数字，并修改对应的数值即可
   >
   > 修改时不能直接修改原数据，要写到临时变量里，按确认的时候校验一下修改的内容是否合法，不合法就提示修改无效（这里可以选择提示按任意键退出或者按 0 退出，按 1 重新修改）
   >
   > 在修改的过程中后台应该要继续计时，因为存在修改失败的可能
   >
   > 所以可能需要同时存在至少 3 份的时间信息，一份是目前在计数的、一份用于显示的、一份待保存的

5. 相关文件

   `key4x4` ：实现按键映射

   `Date` ：实现时间结构体、时间进位处理、时间有效性判断

   `timer`：实现后台计时

   `lcd1602`：显示数值

   `delay`：提供延时函数

   > 要不要再写一个文件调用 lcd1602 用来显示日期？
   >
   > 还要控制按键映射，感觉写在主函数里和另外写一个函数/文件没什么差别了

## 不足

1. 没用过光标，应该是有这个功能，目前还不知道怎么用
2. 比较复杂
3. 我懒得写
4. 我还没写
5. 以后再写