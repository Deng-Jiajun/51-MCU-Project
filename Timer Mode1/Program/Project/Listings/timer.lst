C51 COMPILER V9.60.0.0   TIMER                                                             03/21/2022 16:01:53 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\timer.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Source\timer.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Li
                    -stings\timer.lst) TABS(2) OBJECT(.\Objects\timer.obj)

line level    source

   1          #include <reg51.h>
   2          #include "timer.h"
   3          #include "led.h"
   4          #include "delay.h"
   5          
   6          /* 方式 0 定时器只有 16 位，最大值 65535，最多只能定时 8.192ms，所以引入一个 cou
             -nt 计算中断的次数，以中断次数来实现更大的触发执行间隔（count ms）*/
   7          unsigned int COUNT_T0_LED0 = 0;
   8          unsigned int COUNT_T0_LED1 = 0;
   9          
  10          // 间隔时间 100(ms)、200(ms)、400(ms)、1000(ms)
  11          unsigned int INTERVAL_TIME[4] = {100, 200, 400, 1000};
  12          
  13          // 闪烁模式，对应👆4种间隔
  14          unsigned char FLASH_MODE = 0;
  15          
  16          // 初始化定时器 T0（方式1）
  17          void Init_T0_MODE1(void)
  18          {
  19   1          /* 配置定时器 */
  20   1      
  21   1          TMOD &= 0xF0; //（低 4 位全置 0）
  22   1          TMOD |= 0x01; // 方式 1（16 位定时器）、定时模式、无需门控制
  23   1          TR0 = 1;      // 开启定时器 0
  24   1      
  25   1          // 1000μs = 1ms，2^16 = 65536，2^8 = 256
  26   1          TH0 = (65536 - 1000) / 256; // 赋值初值高 8 位（High）
  27   1          TL0 = (65536 - 1000) % 256; // 赋值初值低 8 位（Low）
  28   1      
  29   1          TF0 = 0; // 清标志位
  30   1      
  31   1          /* 配置中断1 */
  32   1          ET0 = 1; // 允许定时器 0 中断
  33   1          EA = 1;  // 打开总中断
  34   1          PT0 = 0; // 配置优先级，低
  35   1      }
  36          
  37          // 定时器 T0（方式1） 中断处理程序（中断向量 1）
  38          void T0_MODE1_IRQHandler(void) interrupt 1
  39          {
  40   1          // 再次初始化
  41   1          TH0 = (65536 - 1000) / 256;
  42   1          TL0 = (65536 - 1000) % 256;
  43   1      
  44   1          COUNT_T0_LED0++;
  45   1      
  46   1          // 每 1s（1000ms） 闪烁一次
  47   1          if (COUNT_T0_LED0 == 1000)
  48   1          {
  49   2              COUNT_T0_LED0 = 0; // 计数归0
  50   2      
  51   2              TurnOnLED(0);
  52   2          }
  53   1          // 亮100ms再关
C51 COMPILER V9.60.0.0   TIMER                                                             03/21/2022 16:01:53 PAGE 2   

  54   1          if (COUNT_T0_LED0 == 100)
  55   1          {
  56   2              TurnOffLED(0);
  57   2          }
  58   1      
  59   1          // 通过外部中断识别按键操作，切换4种闪烁模式
  60   1          COUNT_T0_LED1++;
  61   1          if (COUNT_T0_LED1 == INTERVAL_TIME[FLASH_MODE])
  62   1          {
  63   2              COUNT_T0_LED1 = 0;
  64   2              TurnOnLED(1);
  65   2          }
  66   1          // 亮100ms再关（默认MODE时，LED1会常亮)
  67   1          if (COUNT_T0_LED1 == 100)
  68   1          {
  69   2              TurnOffLED(1);
  70   2          }
  71   1      }
  72          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    175    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
